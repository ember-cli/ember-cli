sudo: false
dist: trusty

addons:
  chrome: stable

language: node_js
node_js:
  - "6"
  - "8"
  - "9"

branches:
  only:
    - master
    - beta
    - release
    - auto
    - /^greenkeeper.*$/

cache:
  yarn: true
  directories:
    - $HOME/.npm
    - $HOME/.cache # includes bower's cache

env:
  - TEST_COMMAND=test-all

matrix:
  fast_finish: true

  # We run our additional tests against the most-recent LTS.
  # Rather than make the support unclear at the top, we'll manually exclude
  # the default build and swap in the different commands.
  exclude:
  - node_js: "6"
    env: TEST_COMMAND=test-all

  # This is the reworking of the tests we run against the most-recent LTS.
  include:
  - node_js: "6"
    env: TEST_COMMAND=test-all:cover
  - node_js: "6"
    env: DISABLE_EMBER_CLI_FEATURES=true; TEST_COMMAND=test-all

script:
  - yarn run $TEST_COMMAND

after_success:
  - if [[ $TEST_COMMAND == 'test-all:cover' ]]; then .travis/codecoverage.sh; fi
  - .travis/deploy.sh
