## Overview

- **cli** parses args and calls the respective **command**
- **command** calls a sequence of **tasks**
- **tasks** do the actual work

## The different components of ember-cli
### cli()
cli is a small function that gets everything going.

Usage:
``` JavaScript
var cli = require('cli');

cli({
    cliArgs: argv, // Required
    inputStream: inputStream, // Required
    outputStream: outputStream // Required
  })
  .then(...);
```

### Commands
Commands are located in the `commands/` folder. They get picked up by `loadCommands()` automatically.

The following file structure is expected (Demonstrated on the imaginary command `develop-ember-cli`):
``` JavaScript
// e.g. commands/develop-ember-cli.js

module.exports = {
  name: 'develop-ember-cli', // Optional, default is the file name
  key: 'developEmberCLI', // Optional, default is the camelized name
  aliases: ['d', 'go-tomster'], // Optional, default is an empty array
  works: 'everywhere', // 'insideProject', 'outsideProject' or 'everywhere'
                       // Optional, default is 'insideProject'
  options: [ // Optional, default is an empty array
    {
      name: 'package-name', // Required
      key: 'packageName' // Optional, default is the camelized name
      type: String, // Required
      default: 'ember-cli', // Optional, default is undefined
      required: false // Optional, default is false
    },
    ...
  ],
  run: function(environment, options) { // Required
    // environment === { ui,
    //                   tasks, // Tasks hash generated by loadTasks()
    //                   commands, // Commands hash generated by loadCommands()
    //                   project: { directory, packageJSON }
    //                 }
    // options     === { packageName, ... }

    // Run tasks and return a promise
  },
  usageInstructions: function() { // Required
    return "Usage Instructions...";
  }
}
```

Best practice is to use the `run()` function only to execute tasks. The real work should be done in these tasks, then.

The promise returned by `run()` should either
- resolve to `undefined`
- reject with an `Error` instance if the error is unhandled
- or reject with `undefined` if it was handled. In this case the command should log something via the `ui` first.

`loadCommands()` assembles from the files in `commands/` a hash that looks like this:
``` JavaScript
{
  developEmberCLI: require('commands/develop-ember-cli'),
  ...
}
```

### Tasks
Located in `lib/tasks`.

Tasks do the real work. They should also do only one thing: For example there are seperate `bower-install` and `npm-install` tasks, not just one unified `install` task. And they should not call other tasks: For example `install-blueprint` shouldn't call `npm-install` directly. That's because the task sequence is determined by the command and thus should be declared there. A tasks has to return a promise which resolves or rejects depending on whether it ran through successfully or not.

The promise of a task should either
- fulfill to `undefined`
- reject with an `Error` instance if the error is unhandled
- or reject with `undefined` if it was handled. In this case the task should log something via the `ui` first.

So, tasks don't have a return value per design.

The file format of a task looks like this:
``` JavaScript
// tasks/npm-install.js

module.exports = {
  name: 'npm-install', // Optional, defaults to file name
  key: 'npmInstall', // Optional, defaults to camelized name
  run: function(environment, options) {
    // environment === { ui, ... }

    // return promise
  }
}
```

`loadTasks()` assembles from the files in `tasks/` a hash that looks like this:
``` JavaScript
{
  npmInstall: require('tasks/npm-install'),
  ...
}
```

## Style guide
- Everything Promise based
- Everything async (except require)
- Short files
- Tests, tests, tests
- Recommended line length <= 80 characters
- No `console.log`, we've our own logging system
- HTML and CSS: Double quotes, JavaScript: Single quotes
- Naming conventions
  - Dasherized (`some-thing`)
    - file, folder and package names
    - CSS classes
    - HTML tags and attributes
  - Camel case (`someThing`)
    - JavaScript (and JSON) propertys and variables
  - Pascal case (`SomeThing`)
    - JavaScript class names
  - Acronyms:
    - Okay: `url`, `id`, `rootURL` (property) or `URL`, `URLParser` (class)
    - Wrong: `Url`,`rootUrl`
    - We stick with how it's done in ember -> `rootURL`
- No comma separated var satements (`var cool = 123, supercool = 456;`)
- Line break at the end of every file

This list only contains style decisions not already covered by JSHint (e.g. mandatory semicolons and other rules are omitted).

### Indentation
#### Aligned require statments
``` JavaScript
var RSVP    = require('rsvp');
var Promise = RSVP.Promise;
```

#### Multiline return statement
``` JavaScript
// Correct
return someFunction(
    someArgument,
    otherArgument
  );

// Wrong
return someFunction(
  someArgument,
  otherArgument
);


// Correct
return returnsAPromise()
  .then(...)
  .catch(...);

// Wrong
return retursAPromise().then(...)
.catch(...);
```