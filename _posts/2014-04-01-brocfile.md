---
layout: post
title: "Brocfile"
permalink: brocfile
github: "https://github.com/stefanpenner/ember-cli/blob/gh-pages/_posts/2014-04-01-brocfile.md"
---

The Brocfile is built in a way that enables an easy upgrade.

{% highlight javascript lineos %}
var EmberApp = require('ember-cli/lib/broccoli/ember-app');

var app = new EmberApp({
  name: require('./package.json').name,

  legacyFilesToAppend: [
    // list of files that are going to be included in `app.js`
  ],

  ignoredModules: [
    // list of files that are not going to be a part of `app.js`
  ],

  importWhitelist: {
    // list of files that will be skipped during the validation
  },

  getEnvJSON: require('./config/environment')
});

module.exports = app.toTree();
{% endhighlight %}

All the heavy lifting is done by `EmberApp` that hides the complexity of managing dependencies.
But at the same time it gives an ability to inject your custom `javascript` and `css` assets.

If you want to your add custom assets:

{% highlight javascript lineos %}
var pickFiles  = require('broccoli-static-compiler');
var mergeTrees = require('broccoli-merge-trees');

var files = pickFiles('vendor', {
  srcDir: 'path/to/assets',
  files:  [
    'custom.css'
  ],
  destDir: '/assets/'
});

var emberApp = app.toTree();

module.exports = mergeTrees([emberApp, files], {
  overwrite: true
});
{% endhighlight %}

Another way to customize your application tree is overriding `styles` method on the instance:

{% highlight javascript lineos %}
// ...
EmberApp.prototype.styles = function() {
  var styles = concatFiles(this.appAndDependencies(), {
    inputFiles: [
      'pure/base.css',
      'pure/grids.css',
      'pure/buttons.css',
      this.name + '/styles/app.css'
    ],
    outputFile: '/assets/app.css'
  });

  if (env === 'production') {
    styles = csso(styles);
  }

  return styles;
};
// ...
{% endhighlight %}

If you want to add `AMD` version of the library, consider using `ES6` syntax:

`vendor/google-maps.amd.js`
{% highlight javascript lineos %}
/* global define, GoogleMaps */
(function() {
  define('GoogleMaps', [], function() {
    'use strict';
    var GoogleMaps = function() {};

    return {
      default: GoogleMaps
    };
  });
})();
{% endhighlight %}

`Brocfile`:

{% highlight javascript lineos %}
// ...
  legacyFilesToAppend: [
    'vendor/google-maps.amd.js'
  ]
// ...
{% endhighlight %}

In your code:

{%highlight javascript lineos %}
import GoogleMaps from 'google-maps';
{% endhighlight %}

If you're using non-AMD version, just simply add a file to `legacyFilesToAppend`:

{% highlight javascript lineos %}
// ...
legacyFilesToAppend: [
  'select2.js'
]
// ...
{% endhighlight %}
